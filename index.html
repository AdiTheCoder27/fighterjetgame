<!DOCTYPE html>
<html>
<head>
    <title>Fighter Jet Game (Pyodide)</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <style>
        body { margin: 0; padding: 20px; background: #222; color: white; font-family: Arial; }
        #game-container { margin: 0 auto; width: 1000px; }
        canvas { background: #0f1428; border: 2px solid #444; display: block; margin: 0 auto; }
        #loading-message { text-align: center; margin: 20px; }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Fighter Jet Game</h1>
        <div id="loading-message">Loading Python runtime... (this may take a moment)</div>
        <canvas id="gameCanvas" width="1000" height="600"></canvas>
    </div>

    <script>
        async function main() {
            // Load Pyodide
            let pyodide = await loadPyodide({
                indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/"
            });
            
            // Show loading progress
            document.getElementById('loading-message').textContent = "Loading Pygame...";
            
            // Load required packages
            await pyodide.loadPackage(["pygame"]);
            
            // Hide loading message
            document.getElementById('loading-message').style.display = "none";
            
            // Run the Python code
            await pyodide.runPython(`
                import pygame
                import random
                import js
                from pygame import Color

                # Setup
                pygame.init()
                WIDTH, HEIGHT = 1000, 600
                
                # Get the canvas from JavaScript
                canvas = js.document.getElementById("gameCanvas")
                win = pygame.display.set_mode((WIDTH, HEIGHT), pygame.SRCALPHA, canvas)
                pygame.display.set_caption("Advanced Fighter Jet Game")
                clock = pygame.time.Clock()

                # Create simple colored rectangles instead of images
                def create_surface(width, height, color):
                    surf = pygame.Surface((width, height), pygame.SRCALPHA)
                    pygame.draw.rect(surf, color, (0, 0, width, height))
                    return surf

                # Simple shapes instead of images
                player_img = create_surface(60, 60, Color(0, 255, 0))  # Green player
                enemy_img = create_surface(60, 60, Color(255, 0, 0))   # Red enemy
                bullet_img = create_surface(20, 10, Color(255, 255, 0))  # Yellow bullet
                missile_img = create_surface(30, 15, Color(255, 165, 0))  # Orange missile

                # Player jet class
                class Player(pygame.sprite.Sprite):
                    def __init__(self):
                        super().__init__()
                        self.image = player_img
                        self.rect = self.image.get_rect(center=(100, HEIGHT//2))
                        self.speed = 5
                        self.health = 100

                    def update(self, keys):
                        if keys[pygame.K_w]: self.rect.y -= self.speed
                        if keys[pygame.K_s]: self.rect.y += self.speed
                        if keys[pygame.K_a]: self.rect.x -= self.speed
                        if keys[pygame.K_d]: self.rect.x += self.speed
                        self.rect.clamp_ip(pygame.Rect(0, 0, WIDTH, HEIGHT))

                    def shoot(self, group, missile=False):
                        if missile:
                            proj = Projectile(self.rect.right, self.rect.centery, 10, is_missile=True)
                        else:
                            proj = Projectile(self.rect.right, self.rect.centery, 15)
                        group.add(proj)

                # Enemy jet class
                class Enemy(pygame.sprite.Sprite):
                    def __init__(self, speed_multiplier=1.0):
                        super().__init__()
                        self.image = enemy_img
                        self.rect = self.image.get_rect(center=(random.randint(WIDTH + 50, WIDTH + 200), random.randint(50, HEIGHT - 50)))
                        base_speed = random.randint(2, 4)
                        self.speed = base_speed * speed_multiplier
                        self.last_shot = pygame.time.get_ticks()

                    def update(self, bullets_group):
                        self.rect.x -= self.speed
                        if self.rect.right < 0:
                            self.kill()
                        now = pygame.time.get_ticks()
                        if now - self.last_shot > random.randint(1500, 2500):
                            bullet = Projectile(self.rect.left, self.rect.centery, -7)
                            bullets_group.add(bullet)
                            self.last_shot = now

                # Projectiles (bullets and missiles)
                class Projectile(pygame.sprite.Sprite):
                    def __init__(self, x, y, speed, is_missile=False):
                        super().__init__()
                        self.image = missile_img if is_missile else bullet_img
                        self.rect = self.image.get_rect(center=(x, y))
                        self.speed = speed
                        self.is_missile = is_missile

                    def update(self):
                        self.rect.x += self.speed
                        if self.rect.right < 0 or self.rect.left > WIDTH:
                            self.kill()

                # Game Over screen with Try Again button
                def show_game_over(score):
                    font = pygame.font.SysFont("Arial", 48)
                    small_font = pygame.font.SysFont("Arial", 24)
                    run = True

                    button_rect = pygame.Rect(WIDTH // 2 - 100, HEIGHT // 2 + 80, 200, 50)

                    while run:
                        win.fill((0, 0, 0))

                        # Texts
                        text = font.render("Game Over", True, (255, 0, 0))
                        score_text = small_font.render(f"Final Score: {score}", True, (255, 255, 255))
                        hint = small_font.render("Press ESC to quit", True, (180, 180, 180))

                        # Draw texts
                        win.blit(text, (WIDTH // 2 - text.get_width() // 2, HEIGHT // 2 - 60))
                        win.blit(score_text, (WIDTH // 2 - score_text.get_width() // 2, HEIGHT // 2))
                        win.blit(hint, (WIDTH // 2 - hint.get_width() // 2, HEIGHT // 2 + 40))

                        # Try Again button
                        pygame.draw.rect(win, (50, 150, 255), button_rect)
                        button_text = small_font.render("Try Again", True, (255, 255, 255))
                        win.blit(button_text, (button_rect.centerx - button_text.get_width() // 2,
                                           button_rect.centery - button_text.get_height() // 2))

                        pygame.display.update()

                        for event in pygame.event.get():
                            if event.type == pygame.QUIT:
                                run = False
                            elif event.type == pygame.KEYDOWN:
                                if event.key == pygame.K_ESCAPE:
                                    run = False
                            elif event.type == pygame.MOUSEBUTTONDOWN:
                                mouse_pos = pygame.mouse.get_pos()
                                if button_rect.collidepoint(mouse_pos):
                                    game_loop()
                                    return

                # Game loop
                def game_loop():
                    player = Player()
                    player_group = pygame.sprite.GroupSingle(player)
                    player_bullets = pygame.sprite.Group()
                    enemy_bullets = pygame.sprite.Group()
                    enemies = pygame.sprite.Group()

                    run = True
                    font = pygame.font.SysFont("Arial", 24)
                    score = 0
                    spawn_event = pygame.USEREVENT + 1
                    pygame.time.set_timer(spawn_event, 1500)

                    while run:
                        clock.tick(60)
                        keys = pygame.key.get_pressed()

                        for event in pygame.event.get():
                            if event.type == pygame.QUIT:
                                run = False
                            if event.type == spawn_event:
                                # Increase enemy speed every 10 points
                                speed_multiplier = 1 + (score // 10) * 0.1
                                enemies.add(Enemy(speed_multiplier))
                            if event.type == pygame.KEYDOWN:
                                if event.key == pygame.K_SPACE:
                                    player.shoot(player_bullets)
                                elif event.key == pygame.K_m:
                                    player.shoot(player_bullets, missile=True)

                        player.update(keys)
                        player_bullets.update()
                        enemy_bullets.update()
                        enemies.update(enemy_bullets)

                        # Handle collisions
                        for enemy in pygame.sprite.groupcollide(enemies, player_bullets, True, True):
                            score += 1

                        if pygame.sprite.spritecollide(player, enemy_bullets, True):
                            player.health -= 5
                            if player.health <= 0:
                                show_game_over(score)
                                return

                        # Drawing
                        win.fill((15, 20, 40))
                        player_group.draw(win)
                        player_bullets.draw(win)
                        enemy_bullets.draw(win)
                        enemies.draw(win)

                        # UI
                        health_text = font.render(f"Health: {player.health}", True, (255, 100, 100))
                        score_text = font.render(f"Score: {score}", True, (255, 255, 0))
                        win.blit(health_text, (10, 10))
                        win.blit(score_text, (10, 40))

                        pygame.display.update()

                # Start game
                game_loop()
            `);
        }

        main().catch(err => {
            console.error("Error loading Pyodide:", err);
            document.getElementById('loading-message').textContent = 
                "Failed to load game. Please check console for errors.";
        });
    </script>
</body>
</html>